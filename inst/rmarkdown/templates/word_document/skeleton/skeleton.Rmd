---
title: "Monitoring Detail Fact Sheet"
output:
  html_document: default
  pdf_document: default
---

```{r, echo=FALSE}
data(salaries)
years <- unique(index$fiscal_year)
```

**Title**

```{r, echo=FALSE, comment=NA, results='asis'}
cat(paste0(unique(index$project_title)))
```

**Project ID**

```{r, echo=FALSE, comment=NA,results='asis'}
cat(paste0(unique(index$project_id)))
```

**Description**

```{r, echo=FALSE, comment=NA, results='asis'}
cat(paste0(unique(index$description)))
```

**Deliverables**

```{r, echo=FALSE, comment=NA,results='asis'}
d <- unique(index$deliverables)
if (length(unique(d)) == 1 && unique(d) == 0) {
  cat(paste0("There are no identified deliverables for this project."))
} else {
    deliverables <- NULL
    if (!(length(unique(d))) == 1) {
      for (i in seq_along(years)) {
        ii <- index[which(index$fiscal_year == years[i]), ]
        deliverables[[i]] <- unique(ii$deliverables)
      }
      deliverables <- unlist(deliverables)
      for (i in seq_along(years)) {
      if (deliverables[i] == 0) {
        deliverables[i] <- "No identified deliverables for this year."
      }
      cat(paste0(years[i], " : ", deliverables[i]))
      cat("  \n")
      cat("  \n") 

      }
    } else {
      
      if (grepl("\t\t\t\t", d)) {
        d <- sub("\t\t\t\t", "", d) # Remove first tab
        if (grepl("\t\t\t\t\t\t",d)) {
          d <- sub("[\t]+","", d)
        }
      }
      cat(paste0("All years (", paste0(years, collapse = ","), ") have the same deliverables:"))
      cat("  \n")
      cat("  \n")
      cat(paste0(d))
    }
}
```

**Milestones**

```{r, echo=FALSE, comment=NA,results='asis'}
m <- unique(index$milestones)
if (length(unique(m)) == 1 && unique(m) == 0) {
  cat(paste0("There are no identified milestones for this project."))
} else {
    milestones <- NULL
    if (!(length(unique(m))) == 1) {
      for (i in seq_along(years)) {
        ii <- index[which(index$fiscal_year == years[i]), ]
        milestones[[i]] <- unique(ii$milestones)
      }
      milestones <- unlist(milestones)
      for (i in seq_along(years)) {
      if (milestones[i] == 0) {
        milestones[i] <- "No identified milestone for this year."
      }
      cat(paste0(years[i], " : ", milestones[i]))
      cat("  \n")
      cat("  \n") 

      }
    } else {
      
      if (grepl("\t\t\t\t", m)) {
        m <- sub("\t\t\t\t", "", m) # Remove first tab
        if (grepl("\t\t\t\t\t\t",m)) {
          m <- sub("[\t]+","", m)
        }
      }
      cat(paste0("All years (", paste0(years, collapse = ","), ") have the same milestones:"))
      cat("  \n")
      cat("  \n")
      cat(paste0(m))
    }
}
```


**Objectives**

```{r, echo=FALSE, comment=NA,results='asis'}
if (unique(index$objectives) == 0) {
  cat(paste0("There are no identified objectives for this project."))
} else {
cat(paste0(unique(index$objectives)))
}
```

**Status**

```{r, echo=FALSE, comment=NA, results='asis'}
status <- NULL
if (!(length(unique(index$status)) == 1)) {
  for (i in seq_along(years)) {
    ii <- index[which(index$fiscal_year == years[i]),]
    status[[i]] <- unique(ii$status)
  }
  status <- unlist(status)
  cat(paste0(years," : ", status, collapse=", "))
} else {
  cat(paste0(unique(index$status)), " for all project years")
}
```

**Lead Contact (s)**

```{r, echo=FALSE, comment=NA,results='asis'}
cat(paste0(unique(index$lead_staff)))
```

**Plots**

```{r, echo=FALSE}
ID <- unique(index$project_id)
```

```{r, echo=FALSE, fig.cap="Figure 1: Bar chat showing the amount of O&M money ($) invested into the project. Graph color coded by funding type"}
plotSPA(om=index, id=ID, which="omBar")
```

```{r, echo=FALSE, fig.cap="Figure 2: Bar chat showing the O&M money allocation for each year of the project"}
plotSPA(om=index, id=ID, which="omAllocation")
```

```{r, echo=FALSE, fig.cap="Figure 3: Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
plotSPA(salary=index2, id=ID, which="salaryBar")
```

```{r, echo=FALSE, fig.cap="Figure 4: Bar graph representing amount of salary money ($) using the median values of a specific job classification"}
plotSPA(salary=index2, id=ID, which="salaryAllocation")
```

```{r, echo=FALSE, fig.cap="Figure 5: Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
plotSPA(om=index, salary=index2, id=ID, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Figure 6: Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}

plotSPA(om=index, salary=index2, which="predictSalary", id=ID, salaries=salaries)

```
