---
title: "Summary Fact Sheet"
output:
  html_document: default
  pdf_document: default
---

<a href ="file://dcnsbiona01a/BIODataSvc/IN/MSP/PowerBI-Projects/dataSPA/outputs/hub/dataSPA.html"><img src="home.png" width="2%"></a>

```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("Data pulled for this report was obtained on ", getData(type="om_date", age=30, cookie=cookie)))

```


<p style="text-align:left;width: 90%">
```{r, echo=FALSE, comment=NA, results="asis"}
IDs <- unique(index$project_id)
path <- "file://dcnsbiona01a/BIODataSvc/IN/MSP/PowerBI-Projects/dataSPA/outputs/reports/"
links <- paste0(path, IDs, ".html")
LINKS <- paste0('<a href="',links,'">',IDs,'</a>')
 
cat("The project IDs included in this theme include: ", LINKS)

```
</p>


# Select the appropriate tab {.tabset}

## Summary

 <font size="4">
```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("Theme: ", paste0(unique(index$theme))))
```
</font>

**Plots**

A number of assumptions exist for the following

1. The calculated salaries use the median salaries for the year specific to the project of each given job classification. 
2. If a classification level is not given in the project planning tool, a level of PC-2 is assumed. 
3. If the salary for a given year of the project is not available in the public DFO pay scale website, the closest year is used.
4. When overtime amounts are considered in the total, it does not take into account that overtime can sometimes be 1.5 or 2X the pay.
5. When a person with job classification EX is associated with a project, they are not included in total salary.
6. For salary predictions, overtime is not accounted for and it is assumed that each classification level worked the same amount of hours as the previous year
7. The PPT was only mandated in the Maritimes region 2 years ago
8. The plots in each tab are heavily dependent on which activity type is assigned in the PPT

```{r, echo=FALSE, fig.cap="Bar chart showing the amount of O&M money ($) invested into the project. Graph color coded by funding type and show the number of deliverables and milestones per year in blue and red respectively"}
plotSPA(om=index, theme=unique(index$theme), which="omBar")
```

### Choose an om allocation plot {.tabset .tabset-dropdown}

```{r, results="asis", echo=FALSE}
df <- plotSPA(om=index, which="omAllocation", theme=unique(index$theme), dataframe = TRUE)
headers <- names(df)
for (j in seq_along(headers)) {
     cat("#### ", headers[j], "\n\n",
         knitr::knit_child("plot.Rmd", quiet = TRUE), "\n\n")
}

```

### {-}


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and O&M increased by 2%. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
plotSPA(om=index,which="predictOM", theme=theme[i])
```



```{r, echo=FALSE, fig.cap="Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
plotSPA(salary=index2, theme=unique(index2$theme), which="salaryBar")
```


### Choose a salary allocation plot {.tabset .tabset-dropdown}

```{r, results="asis", echo=FALSE}
df <- try(plotSPA(salary=index2, which="salaryAllocation", theme=unique(index2$theme), dataframe = TRUE), silent=TRUE)

headers <- names(df)
for (j in seq_along(headers)) {
      cat("#### ", headers[j], "\n\n",
          knitr::knit_child("plot2.Rmd", quiet = TRUE), "\n\n")
}

```

### {-}



```{r, echo=FALSE, fig.cap="Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
#plotSPA(om=index, salary=index2, theme=theme, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}

res <- try(plotSPA(om=index, salary=index2, which="predictSalary", theme=theme[i]), silent=TRUE)

```


## Research

Definition: Systematic investigation and study in order to establish facts and reach new conclusions.

 <font size="4">
```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("Theme: ", paste0(unique(index$theme))))
```
</font>

```{r, echo=FALSE, fig.cap="Bar chart showing the amount of O&M money ($) invested into the project. Graph color coded by funding type and show the number of deliverables and milestones per year in blue and red respectively", results="asis", comment=NA}
run <- ifelse(("Research" %in% unique(index$activity_type)), TRUE, FALSE)
if (run) {
research1 <- index[which(index$activity_type == "Research"),]
plotSPA(om=research1, theme=unique(index$theme), which="omBar")
} else {
  cat(paste0("There are no Research projects for this theme"))
}
```

```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an om allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- plotSPA(om=research1, which="omAllocation", theme=unique(index$theme), dataframe = TRUE)
headers <- names(df)
for (j in seq_along(headers)) {
     cat("#### ", headers[j], "\n\n",
         knitr::knit_child("plot.Rmd", quiet = TRUE), "\n\n")
}
}

```

### {-}

```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and O&M increased by 2%. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
plotSPA(om=research1,which="predictOM", theme=theme[i])
}
```

```{r, echo=FALSE, fig.cap="Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
if (run) {
research2 <- index2[which(index2$activity_type == "Research"),]
res <- try(plotSPA(salary=research2, theme=unique(index2$theme), which="salaryBar"), silent=TRUE)
}
```


```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an salary allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- try(plotSPA(salary=research2, which="salaryAllocation", theme=unique(research2$theme), dataframe = TRUE), silent=TRUE)

headers <- names(df)
for (j in seq_along(headers)) {
      cat("#### ", headers[j], "\n\n",
          knitr::knit_child("plot2.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}



```{r, echo=FALSE, fig.cap="Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
#plotSPA(om=index, salary=index2, theme=theme, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}

if (run) {
res <- try(plotSPA(om=research1, salary=research2, which="predictSalary", theme=unique(index2$theme)), silent=TRUE)
}
```


## Monitoring

Definition: Observe and check the progress or quality of something over a period of time; keep under systematic review.

 <font size="4">
```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("\n"))
cat(paste0("Theme: ", paste0(unique(index$theme))))
```
</font>


```{r, echo=FALSE, fig.cap="Bar chart showing the amount of O&M money ($) invested into the project. Graph color coded by funding type and show the number of deliverables and milestones per year in blue and red respectively",results="asis", comment=NA}
run <- ifelse(("Monitoring" %in% unique(index$activity_type)), TRUE, FALSE)
if (run) {
monitor1 <- index[which(index$activity_type == "Monitoring"),]
plotSPA(om=monitor1, theme=unique(index$theme), which="omBar")
} else {
  cat(paste0("There are no Monitoring projects for this theme"))
}
```

```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an om allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- plotSPA(om=monitor1, which="omAllocation", theme=unique(index$theme), dataframe = TRUE)
headers <- names(df)
for (j in seq_along(headers)) {
     cat("#### ", headers[j], "\n\n",
         knitr::knit_child("plot.Rmd", quiet = TRUE), "\n\n")
}
}

```

### {-}

```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and O&M increased by 2%. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
plotSPA(om=monitor1,which="predictOM", theme=theme[i])
}
```


```{r, echo=FALSE, fig.cap="Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
if (run) {
monitor2 <- index2[which(index2$activity_type == "Monitoring"),]
res <- try(plotSPA(salary=monitor2, theme=unique(index2$theme), which="salaryBar"), silent=TRUE)
}
```


```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an salary allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- try(plotSPA(salary=monitor2, which="salaryAllocation", theme=unique(monitor2$theme), dataframe = TRUE), silent=TRUE)

headers <- names(df)
for (j in seq_along(headers)) {
      cat("#### ", headers[j], "\n\n",
          knitr::knit_child("plot2.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}



```{r, echo=FALSE, fig.cap="Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
#plotSPA(om=index, salary=index2, theme=theme, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
res <- try(plotSPA(om=monitor1, salary=monitor2, which="predictSalary", theme=unique(index2$theme)), silent=TRUE)
}
```


## Assessment

Definition: Guidance or recommendations offered with regard to prudent future action.

 <font size="4">
```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("Theme: ", paste0(unique(index$theme))))
```
</font>


```{r, echo=FALSE, fig.cap="Bar chart showing the amount of O&M money ($) invested into the project. Graph color coded by funding type and show the number of deliverables and milestones per year in blue and red respectively",results="asis", comment=NA}
run <- ifelse(("Assessment" %in% unique(index$activity_type)), TRUE, FALSE)
if (run) {
assessment1 <- index[which(index$activity_type == "Assessment"),]
plotSPA(om=assessment1, theme=unique(index$theme), which="omBar")
} else {
  cat(paste0("There are no Assessment projects for this theme"))
}
```

```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an om allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- plotSPA(om=assessment1, which="omAllocation", theme=unique(index$theme), dataframe = TRUE)
headers <- names(df)
for (j in seq_along(headers)) {
     cat("#### ", headers[j], "\n\n",
         knitr::knit_child("plot.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}

```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and O&M increased by 2%. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
plotSPA(om=assessment1,which="predictOM", theme=theme[i])
}
```


```{r, echo=FALSE, fig.cap="Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
if (run) {
assessment2 <- index2[which(index2$activity_type == "Assessment"),]
res <- try(plotSPA(salary=assessment2, theme=unique(index2$theme), which="salaryBar"), silent=TRUE)
}
```


```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an salary allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- try(plotSPA(salary=assessment2, which="salaryAllocation", theme=unique(assessment2$theme), dataframe = TRUE), silent=TRUE)

headers <- names(df)
for (j in seq_along(headers)) {
      cat("#### ", headers[j], "\n\n",
          knitr::knit_child("plot2.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}



```{r, echo=FALSE, fig.cap="Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
#plotSPA(om=index, salary=index2, theme=theme, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
res <- try(plotSPA(om=assessment1, salary=assessment2, which="predictSalary", theme=unique(index2$theme)))
}
```

## Data Management 

Definition: A product is a tangible items that is put on the marker for acquisition, attention or consumption.

 <font size="4">
```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("Theme: ", paste0(unique(index$theme))))
```
</font>

```{r, echo=FALSE, fig.cap="Bar chart showing the amount of O&M money ($) invested into the project. Graph color coded by funding type and show the number of deliverables and milestones per year in blue and red respectively",results="asis", comment=NA}
run <- ifelse(("Data Management" %in% unique(index$activity_type)), TRUE, FALSE)
if (run) {
management1 <- index[which(index$activity_type == "Data Management"),]
plotSPA(om=management1, theme=unique(index$theme), which="omBar")
} else {
  cat(paste0("There are no Data Management projects for this theme"))
}
```

```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an om allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- plotSPA(om=management1, which="omAllocation", theme=unique(index$theme), dataframe = TRUE)
headers <- names(df)
for (j in seq_along(headers)) {
     cat("#### ", headers[j], "\n\n",
         knitr::knit_child("plot.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}

```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and O&M increased by 2%. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}

if (run) {
plotSPA(om=management1,which="predictOM", theme=theme[i])
}
```


```{r, echo=FALSE, fig.cap="Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
if (run) {
management2 <- index2[which(index2$activity_type == "Data Management"),]
res <- try(plotSPA(salary=management2, theme=unique(index2$theme), which="salaryBar"), silent = TRUE)
}
```


```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an salary allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- try(plotSPA(salary=management2, which="salaryAllocation", theme=unique(management2$theme), dataframe = TRUE), silent=TRUE)

headers <- names(df)
for (j in seq_along(headers)) {
      cat("#### ", headers[j], "\n\n",
          knitr::knit_child("plot2.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}



```{r, echo=FALSE, fig.cap="Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
#plotSPA(om=index, salary=index2, theme=theme, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
res <- try(plotSPA(om=management1, salary=management2, which="predictSalary", theme=unique(index2$theme)))
}
```


## Other (Admin + Outreach)

Definition: A service is an “intangible” item that arises from the output/work of one or more individuals.

 <font size="4">
```{r, echo=FALSE, comment=NA, results="asis"}
cat(paste0("Theme: ", paste0(unique(index$theme))))
```
</font>

```{r, echo=FALSE, fig.cap="Bar chart showing the amount of O&M money ($) invested into the project. Graph color coded by funding type and show the number of deliverables and milestones per year in blue and red respectively",results="asis", comment=NA}
run <- ifelse(("Other" %in% unique(index$activity_type)), TRUE, FALSE)
if (run) {
other1 <- index[which(index$activity_type == "Other"),]
plotSPA(om=other1, theme=unique(index$theme), which="omBar")
} else {
  cat(paste0("There are no Other projects for this theme"))
}
```

```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an om allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- plotSPA(om=other1, which="omAllocation", theme=unique(index$theme), dataframe = TRUE)
headers <- names(df)
for (j in seq_along(headers)) {
     cat("#### ", headers[j], "\n\n",
         knitr::knit_child("plot.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}

```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and O&M increased by 2%. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
plotSPA(om=other1,which="predictOM", theme=theme[i])
}
```


```{r, echo=FALSE, fig.cap="Bar graph representing amount of salary money ($) using the median values of a specific job classification. Graph color coded by funding type indicated by the legend."}
if (run) {
other2 <- index2[which(index2$activity_type == "Other"),]
res <- try(plotSPA(salary=other2, theme=unique(index2$theme), which="salaryBar"), silent=TRUE)
}
```


```{r, echo=FALSE, results="asis"}
if (run) {
cat("### Choose an salary allocation plot {.tabset .tabset-dropdown}")
}
```

```{r, results="asis", echo=FALSE}
if (run) {
df <- try(plotSPA(salary=other2, which="salaryAllocation", theme=unique(other2$theme), dataframe = TRUE), silent=TRUE)

headers <- names(df)
for (j in seq_along(headers)) {
      cat("#### ", headers[j], "\n\n",
          knitr::knit_child("plot2.Rmd", quiet = TRUE), "\n\n")
}
}
```

### {-}



```{r, echo=FALSE, fig.cap="Bar graph representing percentage (%) of Indeterminate vs Non-indeterminate employees for project years.Number of staff shown on the figure in red"}
#plotSPA(om=index, salary=index2, theme=theme, which="indeterminate")
```


```{r, echo=FALSE, fig.cap="Bar graph showing gap in funding (red) if funding stayed the same and salary cost continued to increase. The rate of increase is determined using linear regression. Actual years are shown on the left of the dashed line, and predicted years are on the right of the dashed line. Total gap amount rounded to the nearest dollar shown in red text."}
if (run) {
res <- try(plotSPA(om=other1, salary=other2, which="predictSalary", theme=unique(index2$theme)), silent=TRUE)
}
```

# {-}

